"use strict";(self.webpackChunkgrid_docs=self.webpackChunkgrid_docs||[]).push([[3316],{3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return p}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),m=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=m(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),u=m(a),p=r,h=u["".concat(l,".").concat(p)]||u[p]||c[p]||i;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function p(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var m=2;m<i;m++)o[m]=a[m];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},9965:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return m},toc:function(){return d},default:function(){return u}});var n=a(7462),r=a(3366),i=(a(7294),a(3905)),o=["components"],s={description:"Tutorial shows how to train Text Summarization Models using Lightning Flash on the XSum Dataset"},l="XSum Text Summarization",m={unversionedId:"examples/nlp/xsum-text-summarization",id:"examples/nlp/xsum-text-summarization",title:"XSum Text Summarization",description:"Tutorial shows how to train Text Summarization Models using Lightning Flash on the XSum Dataset",source:"@site/docs/examples/nlp/xsum-text-summarization.md",sourceDirName:"examples/nlp",slug:"/examples/nlp/xsum-text-summarization",permalink:"/examples/nlp/xsum-text-summarization",editUrl:"https://github.com/gridai/grid-docs/tree/main/docs/examples/nlp/xsum-text-summarization.md",tags:[],version:"current",lastUpdatedAt:1644797338,formattedLastUpdatedAt:"2/14/2022",frontMatter:{description:"Tutorial shows how to train Text Summarization Models using Lightning Flash on the XSum Dataset"}},d=[{value:"Goal",id:"goal",children:[],level:2},{value:"Tutorial time",id:"tutorial-time",children:[],level:2},{value:"Task: Text Summarization",id:"task-text-summarization",children:[],level:2},{value:"Dataset: XSum",id:"dataset-xsum",children:[],level:2},{value:"Step 1: Model",id:"step-1-model",children:[],level:2},{value:"Step 2: Start a RUN",id:"step-2-start-a-run",children:[],level:2},{value:"Step 3: Use the model for predictions",id:"step-3-use-the-model-for-predictions",children:[],level:2},{value:"Bonus: CLI equivalent",id:"bonus-cli-equivalent",children:[],level:2}],c={toc:d};function u(e){var t=e.components,s=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},c,s,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"xsum-text-summarization"},"XSum Text Summarization"),(0,i.kt)("h2",{id:"goal"},"Goal"),(0,i.kt)("p",null,"This example covers an abstractive Text Summarization deep learning task"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"What is Text Summarization"),(0,i.kt)("li",{parentName:"ol"},"Training the model using ",(0,i.kt)("inlineCode",{parentName:"li"},"train.py")," script"),(0,i.kt)("li",{parentName:"ol"},"Loading Grid Weights in Flash and Running Summarization Model")),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"This tutorial uses ",(0,i.kt)("strong",{parentName:"p"},"PyTorch Lightning")))),(0,i.kt)("h2",{id:"tutorial-time"},"Tutorial time"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"5 minutes")),(0,i.kt)("h2",{id:"task-text-summarization"},"Task: Text Summarization"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"Text Summarization")," is the task of generating a consise overview of a text's main point into a short sentence/description. For example, taking a web article and describing the topic in a short sentence."),(0,i.kt)("h2",{id:"dataset-xsum"},"Dataset: XSum"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"https://paperswithcode.com/paper/dont-give-me-the-details-just-the-summary"},"Extreme Summarization ","(",(0,i.kt)("strong",{parentName:"a"},"XSum"),")")," dataset is a dataset for evaluation of abstractive single-document summarization systems consisting of 226,711 news articles collected from BBC ","(","2010 to 2017",")"," accompanied with a one-sentence summary. The articles cover a wide variety of subjects ","(","e.g., News, Politics, Sports, Weather, Business, Technology, Science, Health, Family, Education, Entertainment and Arts",")"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Source: https://arxiv.org/pdf/1808.08745.pdf",src:a(6756).Z})),(0,i.kt)("h2",{id:"step-1-model"},"Step 1: Model"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://lightning-flash.readthedocs.io/en/latest/reference/object_detection.html"},"PyTorch Lightning Flash")," enables the quick training, fine tuning, and inferencing of SOTA object detection algorithms such as RetinaNet."),(0,i.kt)("p",null,"For this demo, we're going to be using the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/aribornstein/T5-Summarization-Demo"},"code here")),(0,i.kt)("p",null,"Here's a preview of this code."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'# 1. Download the data\ndownload_data("https://pl-flash-data.s3.amazonaws.com/xsum.zip", "data/")\n\n\n# 2. Load the data\ndatamodule = SummarizationData.from_csv(\n    "input",\n    "target",\n    train_file=train_file,\n    test_file=test_file,\n)\n\n# 3. Build the model\nmodel = SummarizationTask(backbone=\'google/mt5-small\')\n\n# 4. Create the trainer. Run once on data\ntrainer = Trainer()\n\n# 5. Fine-tune the model\ntrainer.finetune(model, datamodule=datamodule)\n\n# 6. Save it!\ntrainer.save_checkpoint("summarization_model_xsum.pt")\n')),(0,i.kt)("h2",{id:"step-2-start-a-run"},"Step 2: Start a RUN"),(0,i.kt)("p",null,"You can reproduce with this button"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://platform.grid.ai/#/runs?script=https://github.com/aribornstein/T5-Summarization-Demo/blob/05d348b4/train.py&cloud=grid&use_spot&instance=g4dn.xlarge&accelerators=1&disk_size=200&framework=lightning&script_args=--grid_name%20silent-iguana-136%20%5C%0A--grid_strategy%20grid_search%20%5C%0A--grid_disk_size%20200%20%5C%0A--grid_max_nodes%2010%20%5C%0A--grid_instance_type%20g4dn.xlarge%20%5C%0A--use_spot%20true%20%5C%0A--grid_framework%20lightning%20%5C%0A--grid_credential%20cc-vnpnm%20%5C%0A--grid_gpus%201%20%5C%0Atrain.py%20--gpus%201%20--max_epochs%203"},(0,i.kt)("img",{parentName:"a",src:"https://camo.githubusercontent.com/1b39d1721301ebc3d08db0971e6d4dd96db28d8028daff32eb3918e22cd1fbe0/68747470733a2f2f696d672e736869656c64732e696f2f62616467652f7269645f41492d72756e2d3738464639362e7376673f6c6162656c436f6c6f723d626c61636b266c6f676f3d646174613a696d6167652f737667253262786d6c3b6261736536342c50484e325a79423361575230614430694e4467694947686c6157646f644430694e44676949475a7062477739496d3576626d5569494868746247357a50534a6f644852774f693876643364334c6e637a4c6d39795a7938794d4441774c334e325a79492b50484268644767675a443069545445674d5452324d6a42684d5451674d5451674d4341774d4445304944453061446c574d7a59754f4567784d693432566a4578614449794c6a56324e3267784d533479566a45305154453049444530494441674d44417a4d693430494442494d5456424d5451674d5451674d4341774d4445674d5452364969426d615778735053496a5a6d5a6d4969382b50484268644767675a44306954544d314c6a49674e44686f4d5445754d6c59794e5334315344497a4c6a6c324d5445754d3267784d53347a566a5134656949675a6d6c736244306949325a6d5a694976506a777663335a6e50673d3d",alt:"Grid"}))),(0,i.kt)("p",null,"Or manually train this model on Grid has 4 simple steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create a ",(0,i.kt)("strong",{parentName:"li"},"Run"),"."),(0,i.kt)("li",{parentName:"ul"},"Copy and paste the model script.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"https://github.com/aribornstein/T5-Summarization-Demo/blob/main/train.py\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Select  1xT4 ","(","16 GB",")"," $0.68/h ","(","g4dn.xlarge",")"," as the Accelerator"),(0,i.kt)("li",{parentName:"ul"},"Provide the  run arguments ",(0,i.kt)("inlineCode",{parentName:"li"},"--max_epochs 5")," ",(0,i.kt)("inlineCode",{parentName:"li"},"--gpus 1"))),(0,i.kt)("p",null,"You can add optional flags to this script:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-text"},"--backbone summarization_model_to_train\n--train_file /path/to/train.csv\n--valid_file /path/to/val.csv\n--test_file /path/to/test.csv\n--download False\n")),(0,i.kt)("h2",{id:"step-3-use-the-model-for-predictions"},"Step 3: Use the model for predictions"),(0,i.kt)("p",null,"In this step, we load the Grid weights in Flash and run the model to detect objects."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Download Artifacts from Grid Run")),(0,i.kt)("p",null,(0,i.kt)("img",{src:a(2650).Z})),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Load model to our script and inference in 2 lines of code.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'from flash.text import SummarizationTask\n\n\n# 1. Load the model from a checkpoint\nmodel = SummarizationTask.load_from_checkpoint("./summarization_model_xsum.pt")\n\n# 2. Summarize an article!\nprint(model.predict([\n    """\n    Camilla bought a box of mangoes with a Brixton \xc2\xa310 note, introduced last year to try to keep the money of local\n    people within the community.The couple were surrounded by shoppers as they walked along Electric Avenue.\n    They came to Brixton to see work which has started to revitalise the borough.\n    It was Charles\' first visit to the area since 1996, when he was accompanied by the former\n    South African president Nelson Mandela.Greengrocer Derek Chong, who has run a stall on Electric Avenue\n    for 20 years, said Camilla had been ""nice and pleasant"" when she purchased the fruit.\n    ""She asked me what was nice, what would I recommend, and I said we\'ve got some nice mangoes.\n    She asked me were they ripe and I said yes - they\'re from the Dominican Republic.""\n    Mr Chong is one of 170 local retailers who accept the Brixton Pound.\n    Customers exchange traditional pound coins for Brixton Pounds and then spend them at the market\n    or in participating shops.\n    """\n]))\n')),(0,i.kt)("p",null,"Congratulations you have successfully trained and run inference for your first Text Summarization Model with Grid."),(0,i.kt)("h2",{id:"bonus-cli-equivalent"},"Bonus: CLI equivalent"),(0,i.kt)("p",null,"Here are the equivalent commands for the CLI"),(0,i.kt)("p",null,"First, clone the project"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"git clone https://github.com/aribornstein/T5-Summarization-Demo.git\ncd T5-Summarization-Demo\n")),(0,i.kt)("p",null,"Start run"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"grid run \\\n--instance_type 1_v100_16gb \\\n--framework lightning \\\n--gpus 1 \\\ntrain.py \\\n--max_epochs 5 \\\n--gpus 1\n")))}u.isMDXComponent=!0},2650:function(e,t,a){t.Z=a.p+"assets/images/xsum-artifacts-520ed460e41a06ab991ff92bcda6b906.png"},6756:function(e,t,a){t.Z=a.p+"assets/images/xsum-summary-document-55a43c5ea72b8e9224afab79f6423622.png"}}]);